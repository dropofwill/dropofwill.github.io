<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Drop of Will - task_time and rtasklib updates March 8th</title>

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />

    <link href="../../stylesheets/main-aec3cd83.css" rel="stylesheet" type="text/css" />

    <!-- Viewport declarations -->
    <meta name="viewport" content="width=533">
    <meta name="viewport" content="initial-scale=0.6">
  </head>
  <body>
    <div class="wrapper">

    <header class="hero">
<a href="/">        <img class="logo" alt="Will Paul" src="../../images/logo-ff6fa38a.svg" />
        <!-- <h1> -->
        <!--   &#38;lambda;will.paul -->
        <!-- </h1> -->
</a>      <nav>
        <ul>
          <li class=""><a href="/">projects</a></li>
          <li class=""><a href="/posts">blog</a></li>
          <li><a href="http://github.com/dropofwill">github</a></li>
          <li><a href="http://will-paul.com/resume">resume</a></li>
        </ul>
      </nav>
    </header>

    <div class="typeset" role="main">

        <article class="article">
    <h1>task_time and rtasklib updates March 8th</h1>
		<p>Last week I talked about how all existing <code>TaskWarrior</code> wrappers were not going to satisfy the requirements for <code>task_time</code>, so I decided to roll my own Ruby wrapper <code>rtasklib</code> and started working on the JSON to domain object marshalling and vice versa. I realized that I was reinventing the wheel a bit with the domain objects and to some extent with the data type coercions (though obviously some custom coercions will be necessary).</p>

<p>I want to implement a familiar interface for developers to interact with the TW database, like the guys behind the Python <code>taskllb</code> tried to do with Django’s QuerySet. So I looked into writing it as a simple adapter for one of the major Ruby ORMs, <a href="https://rubygems.org/gems/activerecord">ActiveRecord</a>, <a href="http://datamapper.org">DataMapper</a>, and <a href="http://rom-rb.org">ROM (Ruby Object Mapper)</a>. The ActiveRecord implementation is not particularly friendly to non-SQL data stores and has been quite a bit of work for people using NoSQL to write adapters for. Datamapper had several plain text adapters written (YAML, CSV, etc.), but the whole project had been pretty much been abandoned for ROM. I spent the most time messing around with ROM, it really is a new paradigm for an ORM (the developers might argue it isn’t actually an ORM), but it has not yet hit its 1.0 release and the API keeps changing. So even though they had several plaintext data store adapters implemented, they no longer worked with the current release. And while I think I could probably get it working with a little work, I realized I was spending too much time on it for the value it would bring to this particular project.</p>

<p>However, the time spent with ROM was not a complete loss, because the people working on it have also released part of its core as a separate gem, <a href="https://github.com/solnic/virtus">Virtus</a>, specifically for working with domain objects and providing a framework for coercing data types (as well as handling finalization and circular dependencies).</p>

<p>For the validation layer I’m test driving the <a href="https://github.com/kodio/veto">Veto</a> gem, I was considering using ActiveModel and just including the validations submodule, but if Veto can do the trick that would remove a fairly heavy dependency.</p>

<p>For reading in the config I was thinking about just using just a simple Hash data structure, which is what the Python wrapper <code>taskw</code> did. One downfall of this approach is that TW doesn’t configs don’t actually work like that internally, so we end up with situations like this:</p>

<pre class="highlight plaintext"><code>color = on
color.label.sort = gray10
</code></pre>

<p>Which cannot be stored as a hash, <code>taskw</code> admits this and prefers child configs to parent ones. That’s why I’m going to treat the <code>.taskrc</code> file as its own read-only domain object, perhaps generated by the <code>task show</code> command or by reading the <code>~/.taskrc</code> with something like <a href="https://github.com/datafolklabs/ruby-parseconfig"><code>parseconfig</code></a>, though since TW uses dot syntax it might be just as simple to implement it myself (something like <a href="https://gist.github.com/potatosalad/760726">this quick and dirty gist</a>).</p>

<h2 id="big-picture">Big Picture</h2>

<p>Here’s a broad sweeping overview of my currently planned architecture. The following shows the modules, classes, as well as inheritance and composition and some of the class methods. Of course all this is subject to change, but this is where I am at right now.</p>

<pre class="highlight plaintext"><code># Public interface, only part of the application a user should interact with
Rtasklib::TW
# Loads .taskrc in on intialization, finds the data store and custom UDAs
::new(rc="~/.taskrc", config_override={})

# Glue that holds everything together
Rtasklib::Controller

# Domain objects &lt;=&gt; JSON for import/export
Rtasklib::Models
include Virtus.model
::Task
::Taskrc

# Connected with each relevant attribute in the model
Rtasklib::Validations
include Veto.validator
::UUID
::String
::StringArray
::Numeric
::Date
::Duration

# Runs the actual shell commands (using Open3)
Rtasklib::Exectute
include Open3
::write(filter, data)
::read(filter)
::execute(args*)

Rtasklib::ParseConfig
# or possibly
Rtasklib::ParseConfig &lt; ParseConfig
</code></pre>

<h2 id="moving-forward">Moving Forward</h2>

<p>I hope to have the models ‘done’ by next week and hopefully enough of the architecture around it done so that I can begin building <code>task_time</code> against it as quickly as possible, so I can figure out the design flaws earlier rather than later.</p>


    <div class="article-comments">
			<div id="disqus_thread">
	
	<script async="true" src="http://dropofwill.disqus.com/embed.js" type="text/javascript"></script>
	<noscript>
		<a>(href="http://#{short_name}.disqus.com/embed.js?url=ref") View comments.</a>
	</noscript>
</div>

    </div>
  </article>

  <aside>
    <h2>Recent Articles</h2>
    <ol>
        <li>
          <a href="../pacing-and-character-in-mcconaugheys-performance-in-mud/">Pacing and character in McConaughey’s performance in Mud</a> <span>Nov 19</span>
        </li>
        <li>
          <a href="../leitmotif-in-dr-strangelove/">Leitmotif and comedic relief in Kubrick's Dr. Strangelove</a> <span>Oct 29</span>
        </li>
        <li>
          <a href="../establishing-narrative-control-in-freers-high-fidelity/">Establishing narrative control in Freer's High Fidelity</a> <span>Sep 30</span>
        </li>
        <li>
          <a href="../a-scanner-orderly-the-smart-coaster/">A Scanner Orderly: The smart coaster</a> <span>May 20</span>
        </li>
        <li>
          <a href="../rtasklib-first-release/">rtasklib first release</a> <span>May 19</span>
        </li>
        <li>
          <a href="../packaging-ruby-gems/">Packaging Ruby gems</a> <span>May 10</span>
        </li>
        <li>
          <a href="../rtasklib-update/">rtasklib update</a> <span>Apr 20</span>
        </li>
        <li>
          <a href="../playing-power-chords-on-an-arduino/">Playing power chords on an Arduino</a> <span>Apr 14</span>
        </li>
        <li>
          <a href="../rtasklib-update-ruby-and-external-tools/">rtasklib update: Ruby and external tools</a> <span>Apr  6</span>
        </li>
        <li>
          <a href="../lit-review-of-the-quantifying-the-value-of-open-source-hardware-development/">Review of: the Quantifying the Value of Open Source Hardware Development</a> <span>Mar 31</span>
        </li>
    </ol>

    <h2>Tags</h2>
    <ol class="columnize">
        <li><a href="/tags/linuxdev/">LinuxDev (11)</a></li>
        <li><a href="/tags/task_time/">task_time (4)</a></li>
        <li><a href="/tags/physical-computing/">Physical Computing (5)</a></li>
        <li><a href="/tags/bizleg/">BizLeg (15)</a></li>
        <li><a href="/tags/arduino/">Arduino (5)</a></li>
        <li><a href="/tags/hfoss/">HFOSS (4)</a></li>
        <li><a href="/tags/bugfix/">Bugfix (1)</a></li>
        <li><a href="/tags/javascript/">JavaScript (3)</a></li>
        <li><a href="/tags/c/">C (1)</a></li>
        <li><a href="/tags/data-viz/">Data Viz (3)</a></li>
        <li><a href="/tags/ruby/">Ruby (14)</a></li>
        <li><a href="/tags/middleman/">Middleman (3)</a></li>
        <li><a href="/tags/blog/">Blog (2)</a></li>
        <li><a href="/tags/deployment/">Deployment (1)</a></li>
        <li><a href="/tags/film/">Film (3)</a></li>
        <li><a href="/tags/cinematography/">Cinematography (1)</a></li>
        <li><a href="/tags/review/">Review (10)</a></li>
        <li><a href="/tags/trademark/">Trademark (2)</a></li>
        <li><a href="/tags/d3/">D3 (1)</a></li>
        <li><a href="/tags/legal/">Legal (1)</a></li>
        <li><a href="/tags/licenses/">Licenses (1)</a></li>
        <li><a href="/tags/econ/">Econ (2)</a></li>
        <li><a href="/tags/wearables/">Wearables (2)</a></li>
        <li><a href="/tags/mouse-rat/">Mouse Rat (2)</a></li>
        <li><a href="/tags/vim/">Vim (3)</a></li>
        <li><a href="/tags/config/">Config (3)</a></li>
        <li><a href="/tags/business/">Business (1)</a></li>
        <li><a href="/tags/rtasklib/">rtasklib (7)</a></li>
        <li><a href="/tags/foss/">FOSS (1)</a></li>
        <li><a href="/tags/remix/">Remix (2)</a></li>
        <li><a href="/tags/patents/">Patents (1)</a></li>
        <li><a href="/tags/ip/">IP (1)</a></li>
        <li><a href="/tags/processing/">Processing (1)</a></li>
        <li><a href="/tags/nlp/">NLP (2)</a></li>
        <li><a href="/tags/semantics/">Semantics (2)</a></li>
        <li><a href="/tags/video/">Video (1)</a></li>
        <li><a href="/tags/talk/">Talk (1)</a></li>
        <li><a href="/tags/functional-programming/">Functional Programming (1)</a></li>
        <li><a href="/tags/python/">Python (1)</a></li>
    </ol>

    <h2>By Year</h2>
    <ol>
        <li><a href="/2015/">2015 (28)</a></li>
        <li><a href="/2014/">2014 (16)</a></li>
    </ol>
  </aside>


    </div>
  </div>
  </body>
</html>
